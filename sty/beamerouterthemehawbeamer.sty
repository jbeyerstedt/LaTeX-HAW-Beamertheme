% !TEX root = ./main.tex
%
% Theme File for Beamer Presentations inspired by the 2017 Corporate Design
% at Hochschule f√ºr Angewandte Wissenschaften Hamburg
% Author: Jannik Beyerstedt
%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerouterthemehawbeamer}

\RequirePackage{etoolbox}
\RequirePackage{calc}
\RequirePackage{ifthen}


\newlength\hawbeamer@lengths@logoheight
\setlength\hawbeamer@lengths@logoheight{15mm}
\newlength\hawbeamer@lengths@logoheightsmall
\setlength\hawbeamer@lengths@logoheightsmall{10mm}
\newlength{\hawbeamer@titleseparator@linewidth}
\setlength{\hawbeamer@titleseparator@linewidth}{1pt}


\setbeamertemplate{navigation symbols}{}
\defbeamertemplate{frame footer}{none}{}
\defbeamertemplate{frame footer}{hawcd}{
  \Ifaculty \par
  \vspace{0.3em}
  \textmd{\tiny \insertauthor, \Ifooterinfo}
}
\defbeamertemplate{frame numbering}{none}{}
\defbeamertemplate{frame numbering}{counter}{\insertframenumber}
\defbeamertemplate{frame numbering}{fraction}{
  \insertframenumber/\inserttotalframenumber
}
\defbeamertemplate{headline}{plain}{}
\defbeamertemplate*{footline}{plain}{%
  \begin{beamercolorbox}[wd=\textwidth, ht=2.5ex, sep=0em]{footline}%
    \ifnum\c@framenumber=0\else%
      \usebeamerfont{page number in head/foot}
      \usebeamercolor{page number in head/foot}
      \hfill \usebeamertemplate*{frame numbering}
      \par
      \vspace{2mm}
      \begin{tikzpicture}
        \fill[hawbeamer@lightGray] (0,0) rectangle (\textwidth, \hawbeamer@titleseparator@linewidth);
      \end{tikzpicture}%
      \par%
      \vspace{1.2em}

      \usebeamerfont{footline}
      \usebeamercolor{footline}
      \usebeamertemplate*{frame footer}
      \vspace{0.5em}

      \begin{tikzpicture}[remember picture, overlay]
        \node[at=(current page.south east), anchor=south east, inner sep=0] {
          \includegraphics[height=\hawbeamer@lengths@logoheightsmall]{logo-haw-2017}};
      \end{tikzpicture}
    \fi
  \end{beamercolorbox}%
}


\setbeamertemplate{title page}{
  \setcounter{framenumber}{0}   % needed for slide numbering
  \begin{minipage}[b][\paperheight]{\textwidth}
    \vfill%
    \ifx\inserttitle\@empty\else\usebeamertemplate*{title}\fi
    \ifx\insertsubtitle\@empty\else\usebeamertemplate*{subtitle}\fi
    \vspace*{3em}
    \ifx\beamer@shortauthor\@empty\else\usebeamertemplate*{author}\fi
    \ifx\insertinstitute\@empty\else\usebeamertemplate*{institute}\fi
    \ifx\insertdate\@empty\else\usebeamertemplate*{date}\fi
    \vfill
    \vspace*{1mm}
  \end{minipage}
  \begin{tikzpicture}[remember picture, overlay]
    \node[at=(current page.south east), anchor=south east,inner sep=2mm] {
      \includegraphics[height=\hawbeamer@lengths@logoheight]{logo-haw-2017}};
  \end{tikzpicture}
}
\def\maketitle{%
  \ifbeamer@inframe
    \titlepage
  \else
    \frame[plain,noframenumbering]{\titlepage}
  \fi
}
\def\titlepage{%
  \usebeamertemplate{title page}
}

\setbeamertemplate{title}{
  \raggedright%
  \linespread{1.0}%
  \inserttitle%
  \par%
  \vspace*{0.5em}
}
\setbeamertemplate{subtitle}{
  \raggedright%
  \insertsubtitle%
  \par%
  \vspace*{0.5em}
}
\setbeamertemplate{author}{
  \insertauthor%
  \par%
}
\setbeamertemplate{institute}{
  \insertinstitute%
  \par%
}
\setbeamertemplate{date}{
  \insertdate%
  \par%
}


\defbeamertemplate{section page}{simple}{
  \begin{center}
    \usebeamercolor[fg]{section title}
    \usebeamerfont{section title}
    \insertsectionhead\par
    \ifx\insertsubsectionhead\@empty\else
      \usebeamercolor[fg]{subsection title}
      \usebeamerfont{subsection title}
      \insertsubsectionhead
    \fi
  \end{center}
}
\newcommand{\hawbeamer@disablesectionpage}{
  \AtBeginSection{
    % intentionally empty
  }
}
\newcommand{\hawbeamer@enablesectionpage}{
  \AtBeginSection{
    \ifbeamer@inframe
      \sectionpage
    \else
      \frame[plain,c,noframenumbering]{\sectionpage}
    \fi
  }
}

\setbeamertemplate{subsection page}{%
  \usebeamertemplate*{section page}
}
\newcommand{\hawbeamer@disablesubsectionpage}{
  \AtBeginSubsection{
    % intentionally empty
  }
}
\newcommand{\hawbeamer@enablesubsectionpage}{
  \AtBeginSubsection{
    \ifbeamer@inframe
      \subsectionpage
    \else
      \frame[plain,c,noframenumbering]{\subsectionpage}
    \fi
  }
}


\newlength{\metropolis@frametitle@padding}
\setlength{\metropolis@frametitle@padding}{2.2ex}
\newcommand{\metropolis@frametitlestrut@start}{
  \rule{0pt}{\metropolis@frametitle@padding +%
    \totalheightof{%
      \ifcsdef{metropolis@frametitleformat}{\metropolis@frametitleformat X}{X}%
    }%
  }%
}
\newcommand{\metropolis@frametitlestrut@end}{
  \rule[-\metropolis@frametitle@padding]{0pt}{\metropolis@frametitle@padding}
}
\defbeamertemplate{frametitle}{plain}{%
  \nointerlineskip%
  \begin{beamercolorbox}[%
      wd=\paperwidth,%
      sep=0pt,%
      leftskip=\metropolis@frametitle@padding,%
      rightskip=\metropolis@frametitle@padding,%
    ]{frametitle}%
  \metropolis@frametitlestrut@start%
  \insertframetitle%
  \nolinebreak%
  \metropolis@frametitlestrut@end%
  \end{beamercolorbox}%
}
\setbeamertemplate{frametitle continuation}{%
  \usebeamerfont{frametitle}
  \romannumeral \insertcontinuationcount
}

\endinput
